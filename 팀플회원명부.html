<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŒ€í”ŒíšŒì›ëª…ë¶€</title>
<script src="https://cdn.jsdelivr.net/npm/korean-lunar-calendar/dist/korean-lunar-calendar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  :root {--toss-blue:#3182f6;--toss-blue-hover:#1b64da;--toss-gray:#f9fafb;--toss-dark:#191f28;--toss-sub:#4e5968;--white:#fff;}
  *{box-sizing:border-box;font-family:"Pretendard","Noto Sans KR",sans-serif;}
  body{background:var(--toss-gray);color:var(--toss-dark);margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;}
  h1{font-size:1.6em;font-weight:700;margin:20px 0;}
  .controls,.add-form,.backup-area{width:100%;max-width:1100px;display:flex;flex-wrap:wrap;justify-content:space-between;gap:10px;margin-bottom:10px;}
  input,select,button{border:1px solid #ccc;border-radius:8px;padding:8px 10px;font-size:0.9em;}
  input:focus,select:focus{outline:1.5px solid var(--toss-blue);}
  button{background:var(--toss-blue);color:white;border:none;cursor:pointer;transition:0.2s;}
  button:hover{background:var(--toss-blue-hover);}
  .table-wrap{width:100%;max-width:1100px;overflow-x:auto;background:var(--white);border-radius:18px;box-shadow:0 8px 25px rgba(0,0,0,0.08);}
  table{width:100%;min-width:800px;border-collapse:collapse;}
  thead{background:var(--toss-blue);color:white;}
  th,td{padding:10px 8px;text-align:center;font-size:0.9em;white-space:nowrap;}
  tbody tr:nth-child(even){background:#f6f8fb;}
  tr.highlight-row{background:var(--toss-blue)!important;color:white;font-weight:700;}
  .highlight{color:var(--toss-blue);font-weight:600;}
  tr.highlight-row .highlight{color:#fff;}
  select.note{border-radius:6px;padding:4px 6px;border:1px solid #ccc;background:#fff;}
  .dday{font-weight:600;}
  .dday.soon{color:#d62828;}.dday.today{color:#00b894;}.dday.after{color:#747d8c;}
  footer{margin-top:25px;color:var(--toss-sub);font-size:0.85em;text-align:center;}
  .save-status{margin-top:10px;font-size:0.85em;color:var(--toss-sub);}
  .remove-btn{color:#ff4d4d;background:none;border:none;cursor:pointer;font-weight:bold;}
  .remove-btn:hover{text-decoration:underline;}
  @media(max-width:768px){body{padding:10px;}table{font-size:0.85em;}th,td{padding:8px 6px;}}
</style>
</head>
<body>

<h1 id="title">ğŸ‚ íŒ€í”ŒíšŒì›ëª…ë¶€</h1>

<!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
<div class="controls">
  <input type="text" id="searchInput" placeholder="ğŸ” ì´ë¦„ ê²€ìƒ‰..." onkeyup="filterTable()">
  <select id="monthFilter" onchange="filterTable()">
    <option value="">ğŸ“… ì „ì²´ ì›”</option>
    <option value="1">1ì›”</option><option value="2">2ì›”</option><option value="3">3ì›”</option>
    <option value="4">4ì›”</option><option value="5">5ì›”</option><option value="6">6ì›”</option>
    <option value="7">7ì›”</option><option value="8">8ì›”</option><option value="9">9ì›”</option>
    <option value="10">10ì›”</option><option value="11">11ì›”</option><option value="12">12ì›”</option>
  </select>
  <button onclick="exportExcel()">ğŸ“¤ ì—‘ì…€ë¡œ ë‚´ë³´ë‚´ê¸°</button>
</div>

<!-- íšŒì› ì¶”ê°€ -->
<div class="add-form">
  <input type="text" id="newName" placeholder="ì´ë¦„">
  <input type="text" id="newPhone" placeholder="ì „í™”ë²ˆí˜¸ (010-XXXX-XXXX)">
  <input type="text" id="newBirth" placeholder="ìƒë…„ì›”ì¼ (ì˜ˆ: 1970-04-08)">
  <select id="newType"><option value="ì–‘ë ¥">ì–‘ë ¥</option><option value="ìŒë ¥">ìŒë ¥</option></select>
  <input type="text" id="newAddr" placeholder="ì£¼ì†Œ">
  <button onclick="addMember()">â• íšŒì› ì¶”ê°€</button>
</div>

<!-- ë°±ì—…/ë³µì› -->
<div class="backup-area">
  <button onclick="backupData()">ğŸ’¾ ë°ì´í„° ë°±ì—…(JSON)</button>
  <input type="file" id="restoreFile" accept=".json" onchange="restoreData(event)">
</div>

<!-- í…Œì´ë¸” -->
<div class="table-wrap">
  <table id="memberTable">
    <thead>
      <tr>
        <th>íšŒì›ëª…</th><th>ì „í™”ë²ˆí˜¸</th><th>ìƒë…„ì›”ì¼</th>
        <th>ì˜¬í•´ ì–‘ë ¥ ìƒì¼</th><th>D-Day</th><th>ì£¼ì†Œ</th><th>ë¹„ê³ </th><th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="memberBody"></tbody>
  </table>
</div>

<div class="save-status" id="saveStatus">ğŸ’¾ ë³€ê²½ì‚¬í•­ì€ ìë™ì €ì¥ ë©ë‹ˆë‹¤.</div>
<footer>â€» ì´ë²ˆ ë‹¬ ìƒì¼ìëŠ” íŒŒë€ìƒ‰ìœ¼ë¡œ ê°•ì¡°ë©ë‹ˆë‹¤.<br>â€» ìƒˆí•´ì—ëŠ” ì—°ë„ê°€ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.</footer>

<script>
  const calendar=new KoreanLunarCalendar();
  const today=new Date(),thisYear=today.getFullYear(),thisMonth=today.getMonth()+1;
  document.getElementById("title").innerText=`ğŸ‚ ${thisYear}ë…„ íŒ€í”ŒíšŒì›ëª…ë¶€`;

  // ê¸°ë³¸ íšŒì› ëª©ë¡
  const defaultMembers=[{name:"ê³½ì—°í¬",phone:"010-7566-5332",lunar:[4,25,false],solarOrigin:"1974-04-25",addr:"ì™€ë™ 803-4 ì‚¼ì‹ ë§¨ì…˜ 202í˜¸",note:""},
    {name:"ê¹€ìš©ìš´",phone:"010-5706-2349",lunar:[5,20,false],solarOrigin:"1967-05-20",addr:"ì™€ë™ 761-5, 202í˜¸",note:""},
    {name:"ê¹€ì¸ì¤‘",phone:"010-2331-1614",lunar:[8,6,false],solarOrigin:"1964-08-06",addr:"ë‹¨ì›êµ¬ ì™€ë™",note:""},
    {name:"ê¹€ì •ë²”",phone:"010-5880-4122",lunar:"ì–‘ë ¥",solarOrigin:"1995-05-11",addr:"ë‹¨ì›êµ¬ ì„ ì‚¼ë¡œ6ê¸¸ 66",note:""},
    {name:"ê¹€ì¶˜í™”",phone:"010-6277-5628",lunar:[4,8,false],solarOrigin:"1970-04-08",addr:"ë¶€ë¶€ë¡œ5ê¸¸ 2, ì€ìš°í•˜ì´ì¸ ë¹Œ Aë™ 401í˜¸",note:""},
    {name:"ë‚˜ì •ìˆ™",phone:"010-5049-3681",lunar:[11,25,false],solarOrigin:"1975-11-25",addr:"ì™€ë™ 97-2 í¬ë§ë¹Œë¼ 302í˜¸",note:""},
    {name:"ë°•ë™ì›",phone:"010-9563-3478",lunar:"ì–‘ë ¥",solarOrigin:"1967-01-25",addr:"ì™€ë™ 775-8, 103í˜¸",note:""},
    {name:"ë°•ë³´ê²½",phone:"010-7331-8746",lunar:"ì–‘ë ¥",solarOrigin:"1967-01-16",addr:"ì„ ë¶€ë¡œ 166 ê³µì‘í•œì–‘ 113ë™ 206í˜¸",note:""},
    {name:"ë³€ìš©í™˜",phone:"010-4722-3365",lunar:[9,3,false],solarOrigin:"1976-09-03",addr:"ì™€ë™ 788, 401í˜¸",note:""},
    {name:"ì„œê·œì„",phone:"010-3652-8929",lunar:[4,3,false],solarOrigin:"1968-04-03",addr:"ë‹¨ì›êµ¬ ì™€ë™",note:""},
    {name:"ì‹ ì¤€í˜¸",phone:"010-9164-2404",lunar:[3,19,false],solarOrigin:"1974-03-19",addr:"ì„ìˆ˜ë¡œ 138, ë©”íŠ¸ë¡œí‘¸ë¥´ì§€ì˜¤ 106ë™ 102í˜¸",note:""},
    {name:"ì›ìˆ˜ì§„",phone:"010-8858-1927",lunar:[11,10,false],solarOrigin:"1978-11-10",addr:"ì™€ë™ê³µì›ë¡œ4ê¸¸ 36, ìœ„ì¦ˆë¤í•˜ìš°ìŠ¤ Aë™ 401í˜¸",note:""},
    {name:"ìœ¤ê²½í¬",phone:"010-2822-5397",lunar:[6,28,false],solarOrigin:"1968-06-28",addr:"ì„ìˆ˜ë¡œ 138, ë©”íŠ¸ë¡œí‘¸ë¥´ì§€ì˜¤ 109ë™ 104í˜¸",note:""},
    {name:"ìœ¤ì˜ìš´",phone:"010-3686-7502",lunar:[5,3,false],solarOrigin:"1971-05-03",addr:"ì¸ì²œ ë¯¸ì¶”í™€êµ¬ ì¸ì£¼ëŒ€ë¡œ 148, íš¨ì„±í•´ë§í„´íƒ€ì›Œ 101ë™ 1711í˜¸",note:""},
    {name:"ìœ¤ì¬ê·¼",phone:"010-6235-9099",lunar:[10,7,false],solarOrigin:"1963-10-07",addr:"ì‹œí¥ì‹œ ê±°ëª¨ë™ ìœ í˜¸ì•„íŒŒíŠ¸ 103ë™ 701í˜¸",note:""},
    {name:"ì´ë¯¸ìˆœ",phone:"010-9426-2668",lunar:[6,17,false],solarOrigin:"1976-06-17",addr:"ì™€ë™ 753-11, 302í˜¸",note:""},
    {name:"ì´ì¬ê·œ",phone:"010-5182-1533",lunar:"ì–‘ë ¥",solarOrigin:"1987-11-24",addr:"ê´‘ë•ì‚°1ë¡œ 19, í•´ì˜¤ë¦„ì•„íŒŒíŠ¸ 1203í˜¸",note:"ì´ë¬´"},
    {name:"ì •êµ¬ì¸",phone:"010-9076-1032",lunar:[3,13,false],solarOrigin:"1971-03-13",addr:"ì™€ë™ 803-4 ì‚¼ì‹ ë§¨ì…˜ 202í˜¸",note:""},
    {name:"ì¡°ìš©ê·¼",phone:"010-4856-2668",lunar:[7,9,false],solarOrigin:"1969-07-09",addr:"ì™€ë™ 753-11, 302í˜¸",note:"íšŒì¥"},
    {name:"ìµœë§ŒìŠ¹",phone:"010-2282-0228",lunar:[9,18,false],solarOrigin:"1964-09-18",addr:"ë‹¬ë¯¸ë¡œ 129",note:""}];

  let members=JSON.parse(localStorage.getItem("team_members")||"null")||defaultMembers;
  const savedNotes=JSON.parse(localStorage.getItem("team_notes")||"{}");
  members.forEach(m=>{if(savedNotes[m.name])m.note=savedNotes[m.name];});

  const tbody=document.getElementById("memberBody");

  function renderTable(){
    tbody.innerHTML="";
    members.forEach((mem,idx)=>{
      let thisYearSolar="";
      if(mem.lunar==="ì–‘ë ¥"){const[,m,d]=mem.solarOrigin.split("-");thisYearSolar=`${thisYear}-${m}-${d}`;}
      else{const[m,d,leap]=mem.lunar;calendar.setLunarDate(thisYear,m,d,leap);
        const s=calendar.getSolarCalendar();
        thisYearSolar=`${s.year}-${String(s.month).padStart(2,"0")}-${String(s.day).padStart(2,"0")}`;}
      const birth=new Date(thisYearSolar);
      let diff=Math.ceil((birth-today)/(1000*60*60*24)),txt="",cls="";
      if(diff===0){txt="ğŸ‰ ì˜¤ëŠ˜";cls="today";}else if(diff>0){txt=`D-${diff}`;cls=diff<=7?"soon":"";}else{txt=`D+${Math.abs(diff)}`;cls="after";}
      const monthNum=parseInt(thisYearSolar.split("-")[1]);
      const tr=document.createElement("tr");
      if(monthNum===thisMonth)tr.classList.add("highlight-row");
      const noteSel=`<select class="note" onchange="updateNote('${mem.name}',this.value)">
        <option value=""></option><option value="ì´ë¬´"${mem.note==="ì´ë¬´"?"selected":""}>ì´ë¬´</option>
        <option value="íšŒì¥"${mem.note==="íšŒì¥"?"selected":""}>íšŒì¥</option></select>`;
      tr.innerHTML=`<td>${mem.name}</td><td>${mem.phone}</td><td>${mem.solarOrigin}</td>
        <td class="highlight">${thisYearSolar}</td><td class="dday ${cls}">${txt}</td><td>${mem.addr}</td>
        <td>${noteSel}</td><td><button class="remove-btn" onclick="removeMember(${idx})">âœ–</button></td>`;
      tbody.appendChild(tr);
    });
  }
  renderTable();

  function updateNote(name,val){
    const s=document.getElementById("saveStatus");
    const notes=JSON.parse(localStorage.getItem("team_notes")||"{}");
    notes[name]=val;localStorage.setItem("team_notes",JSON.stringify(notes));
    s.textContent=`âœ… ${name} ë‹˜ì˜ ë¹„ê³  ì €ì¥ë¨`;s.style.color="green";
    setTimeout(()=>{s.textContent="ğŸ’¾ ë³€ê²½ì‚¬í•­ì€ ìë™ì €ì¥ ë©ë‹ˆë‹¤..";s.style.color="#4e5968";},2000);
  }

  function exportExcel(){
    const wb=XLSX.utils.table_to_book(document.getElementById("memberTable"),{sheet:"íŒ€í”ŒíšŒì›ëª…ë¶€"});
    XLSX.writeFile(wb,`${thisYear}_íŒ€í”ŒíšŒì›ëª…ë¶€.xlsx`);
  }

  function filterTable(){
    const search=document.getElementById("searchInput").value.trim();
    const month=document.getElementById("monthFilter").value;
    document.querySelectorAll("#memberBody tr").forEach(r=>{
      const name=r.querySelector("td:first-child").textContent.trim();
      const dateText=r.querySelector("td:nth-child(4)").textContent.trim();
      let rowMonth="";if(/^\d{4}-\d{2}-\d{2}$/.test(dateText))rowMonth=String(parseInt(dateText.split("-")[1],10));
      r.style.display=((!search||name.includes(search))&&(!month||rowMonth===month))?"":"none";
    });
  }

  function addMember(){
    const name=newName.value.trim(),phone=newPhone.value.trim(),birth=newBirth.value.trim();
    const type=newType.value,addr=newAddr.value.trim();
    if(!name||!phone||!birth){alert("ì´ë¦„, ì „í™”ë²ˆí˜¸, ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤!");return;}
    let lunar=type==="ì–‘ë ¥"?"ì–‘ë ¥":(()=>{const[,m,d]=birth.split("-");return [parseInt(m),parseInt(d),false];})();
    members.push({name,phone,lunar,solarOrigin:birth,addr,note:""});
    localStorage.setItem("team_members",JSON.stringify(members));
    renderTable();alert(`âœ… ${name} ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    document.querySelectorAll(".add-form input").forEach(i=>i.value="");
  }

  function removeMember(i){
    if(confirm(`ì •ë§ ${members[i].name} íšŒì›ì„ ì‚­ì œí• ê¹Œìš”?`)){
      members.splice(i,1);localStorage.setItem("team_members",JSON.stringify(members));renderTable();
    }
  }

  // ğŸ’¾ ë°ì´í„° ë°±ì—… (JSON ë‹¤ìš´ë¡œë“œ)
  function backupData(){
    const blob=new Blob([JSON.stringify(members,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download=`teampl_backup_${thisYear}.json`;
    a.click();
  }

  // â™» ë°ì´í„° ë³µì›
  function restoreData(e){
    const file=e.target.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=evt=>{
      try{
        members=JSON.parse(evt.target.result);
        localStorage.setItem("team_members",JSON.stringify(members));
        renderTable();
        alert("âœ… ë°ì´í„° ë³µì› ì™„ë£Œ!");
      }catch(err){alert("âš  ë³µì› ì‹¤íŒ¨: ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");}
    };
    reader.readAsText(file);
  }
</script>
</body>
</html>
